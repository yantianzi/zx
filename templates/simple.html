{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width"/>
    <title>信号优化</title>
    <link rel="stylesheet" href="{% static 'dist/css/indexsimple.css' %}"/>
    <link rel="stylesheet" type="text/javascript"
          href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>
    <script src="https://webapi.amap.com/maps?v=2.0&key=50f1eda45b413745aea17aaf2a54f2e8&plugin=AMap.RectangleEditor"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <script type="text/javascript"
            src="https://webapi.amap.com/maps?v=2.0&key=50f1eda45b413745aea17aaf2a54f2e8"></script>
    <script type="text/javascript"
            src='//webapi.amap.com/maps?v=2.0&key=50f1eda45b413745aea17aaf2a54f2e8&plugin=AMap.ToolBar'></script>
    <!-- UI组件库 1.0 -->
    <script src="//webapi.amap.com/ui/1.1/main.js?v=1.1.1"></script>
</head>
<body>
<!-- 头部 -->
<header>
    <h1>信号灯优化界面</h1>
    <div class="show-time"></div>
    <script>
        // 格式：当前时间：2022年5月3日-13时20分24秒
        var t = null;
        t = setTimeout(time, 1000); //开始运行
        function time() {
            clearTimeout(t); //清除定时器
            dt = new Date();
            var y = dt.getFullYear();
            var mt = dt.getMonth() + 1;
            var day = dt.getDate();
            var h = dt.getHours(); //获取时
            var m = dt.getMinutes(); //获取分
            var s = dt.getSeconds(); //获取秒
            document.querySelector(".show-time").innerHTML = "当前时间：" + y + "年" + mt + "月" + day + "日-" + h + "时" + m + "分" + s + "秒";
            t = setTimeout(time, 1000); //设定定时器，循环运行
        }
    </script>
</header>
<!-- 页面主体部分 -->
<section class="mainbox">
    <!-- 左侧盒子 -->
    <div class="column">
        <div class="panel map" style="height:7rem" tabindex="0">
            <h2>高德地图api调用</h2>
            <!-- 地图自适应 -->
            <div class="input-card">
                <input id="setFitView" type="button" class="btn" value="地图自适应显示"/>
            </div>
            <!-- 高德地图放置盒子 -->
            <div id="map" class="map" style="margin-top:35px;"></div>
            <!-- 伪元素绘制盒子下边角 -->
            <div class="panel-footer"></div>
        </div>
    </div>
    <div class="column">
        <div class="panel" style="height:1.8rem;">
            <h2>信号灯设置方案选择</h2>
            <div style="margin:10px;">
                <form id="form_show" method="post" novalidate>
                    <div class="form-group">
                        <select name="road_id" class="form-control">
                            <option value="0"> - - 请选择路口名称 - -</option>
                            {% for effect in effectlist %}
                                <option value="{{ effect.road_id }}">{{ effect.road_name }}</option>
                            {% endfor %}
                        </select>
                        <select name="configuration_id" class="form-control">
                            <option value="---请选择相位---">------请选择相位------</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                </form>
                <div class="col-xs-2">
                    <input id="btn2" type="button" class="btn btn-primary" value="提交"/>
                </div>
            </div>
            <!-- 伪元素绘制盒子下边角 -->
            <div class="panel-footer"></div>
        </div>
        <div class="panel" style="height:4.7rem;">
            <h2>效能对比分析</h2>
            <!-- 图表放置盒子 -->
            <div style="margin:12.5px;">
                <div>
                    <h4>
                        <div class="searchBox">
                            <font style="color:rgba(219,225,255,1)">整体延误对比:</font>
                        </div>
                    </h4>
                    <table class="table" style="color:rgba(219,225,255,1);font-size:14px;">
                        <th style="width: 130px;text-align:center"></th>
                        <th style="width: 130px;text-align:center">优化前</th>
                        <th style="width: 130px;text-align:center">优化后</th>
                        <tr>
                            <td>总体延误:</td>
                            <td><input id="summary_avg_delay" type="text" placeholder="总体延误" value="{{ summary.avg_delay }}"/></td>
                            <td><input id="summaryOptimized_avg_delay" type="text" placeholder="总体延误" value="{{ summaryOptimized.avg_delay }}"/></td>
                        </tr>
                        <tr>
                            <td>排队长度:</td>
                            <td><input id="summary_queue_length" type="text" placeholder="排队长度" value="{{ summary.queue_length }}"/></td>
                            <td><input id="summaryOptimized_queue_length" type="text" placeholder="排队长度" value="{{ summaryOptimized.queue_length }}"/></td>
                        </tr>
                        <tr>
                            <td>周期内流量:</td>
                            <td><input id="summary_flow_volume" type="text" placeholder="周期内流量" value="{{ summary.flow_volume }}"/></td>
                            <td><input id="summaryOptimized_flow_volume" type="text" placeholder="周期内流量" value="{{ summaryOptimized.flow_volume }}"/></td>
                        </tr>
                        <tr>
                            <td>绿灯利用率:</td>
                            <td><input id="summary_greenrate" type="text" placeholder="绿灯利用率" value="{{ summary.greenrate }}"/></td>
                            <td><input id="summaryOptimized_greenrate" type="text" placeholder="绿灯利用率" value="{{ summaryOptimized.greenrate }}"/></td>
                        </tr>
                        <tr>
                            <td>信号合理性:</td>
                            <td><input id="summary_signal_rationality" type="text" placeholder="信号合理性" value="{{ summary.signal_rationality }}"/></td>
                            <td><input id="summaryOptimized_signal_rationality" type="text" placeholder="信号合理性" value="{{ summaryOptimized.signal_rationality }}"/></td>
                        </tr>
                        <tr>
                            <td>停驶车辆数:</td>
                            <td><input id="summary_paused_vehicle_num" type="text" placeholder="停驶车辆数" value="{{ summary.paused_vehicle_num }}"/></td>
                            <td><input id="summaryOptimized_paused_vehicle_num" type="text" placeholder="停驶车辆数" value="{{ summaryOptimized.paused_vehicle_num }}"/></td>
                        </tr>
                        <tr>
                            <td>平均通过车辆数:</td>
                            <td><input id="summary_avg_passed_vehicle_num" type="text" placeholder="平均通过车辆数" value="{{ summary.avg_passed_vehicle_num }}"/></td>
                            <td><input id="summaryOptimized_avg_passed_vehicle_num" type="text" placeholder="平均通过车辆数" value="{{ summaryOptimized.avg_passed_vehicle_num }}"/></td>
                        </tr>
                        <tr>
                            <td>道路拥塞指数:</td>
                            <td><input id="summary_greenrate_1" type="text" placeholder="道路拥塞指数" value="{{ summary.greenrate }}"/></td>
                            <td><input id="summaryOptimized_greenrate_1" type="text" placeholder="道路拥塞指数" value="{{ summaryOptimized.greenrate }}"/></td>
                        </tr>
                        <tr>
                            <td>通行服务等级:</td>
                            <td><input id="summary_service_level" type="text" placeholder="道路拥塞指数" value="{{ summary.service_level }}"/></td>
                            <td><input id="summaryOptimized_service_level" type="text" placeholder="道路拥塞指数" value="{{ summaryOptimized.service_level }}"/></td>
                        </tr>
                    </table>
                </div><br/>
{#                <div>#}
{#                    <h4>#}
{#                        <div class="searchBox">#}
{#                            <font style="color:rgba(219,225,255,1)">干线延误:</font>#}
{#                        </div>#}
{#                    </h4>#}
{#                    <table class="table" style="color:rgba(219,225,255,1);font-size:14px;">#}
{#                        <th style="width: 130px;text-align:center"></th>#}
{#                        <th style="width: 130px;text-align:center">优化前</th>#}
{#                        <th style="width: 130px;text-align:center">优化后</th>#}
{#                        <tr>#}
{#                            <td>总体延误:</td>#}
{#                            <td><input id="backbone_avg_delay" type="text" placeholder="总体延误" value="{{ backbone.avg_delay }}"/></td>#}
{#                            <td><input id="backboneOptimized_avg_delay" type="text" placeholder="总体延误" value="{{ backboneOptimized.avg_delay }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>排队长度:</td>#}
{#                            <td><input id="backbone_queue_length" type="text" placeholder="排队长度" value="{{ backbone.queue_length }}"/></td>#}
{#                            <td><input id="backboneOptimized_queue_length" type="text" placeholder="排队长度" value="{{ backboneOptimized.queue_length }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>周期内流量:</td>#}
{#                            <td><input id="backbone_flow_volume" type="text" placeholder="周期内流量" value="{{ backbone.flow_volume }}"/></td>#}
{#                            <td><input id="backboneOptimized_flow_volume" type="text" placeholder="周期内流量" value="{{ backboneOptimized.flow_volume }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>绿灯利用率:</td>#}
{#                            <td><input id="backbone_greenrate" type="text" placeholder="绿灯利用率" value="{{ backbone.greenrate }}"/></td>#}
{#                            <td><input id="backboneOptimized_greenrate" type="text" placeholder="绿灯利用率" value="{{ backboneOptimized.greenrate }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>信号合理性:</td>#}
{#                            <td><input id="backbone_signal_rationality" type="text" placeholder="信号合理性" value="{{ backbone.signal_rationality }}"/></td>#}
{#                            <td><input id="backboneOptimized_signal_rationality" type="text" placeholder="信号合理性" value="{{ backboneOptimized.signal_rationality }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>停驶车辆数:</td>#}
{#                            <td><input id="backbone_paused_vehicle_num" type="text" placeholder="停驶车辆数" value="{{ backbone.paused_vehicle_num }}"/></td>#}
{#                            <td><input id="backboneOptimized_paused_vehicle_num" type="text" placeholder="停驶车辆数" value="{{ backboneOptimized.paused_vehicle_num }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>平均通过车辆数:</td>#}
{#                            <td><input id="backbone_avg_passed_vehicle_num" type="text" placeholder="平均通过车辆数" value="{{ backbone.avg_passed_vehicle_num }}"/></td>#}
{#                            <td><input id="bbackboneOptimized_avg_passed_vehicle_num" type="text" placeholder="平均通过车辆数" value="{{ backboneOptimized.avg_passed_vehicle_num }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>道路拥塞指数:</td>#}
{#                            <td><input id="backbone_greenrate_1" type="text" placeholder="道路拥塞指数" value="{{ backbone.greenrate }}"/></td>#}
{#                            <td><input id="backboneOptimized_greenrate_1" type="text" placeholder="道路拥塞指数" value="{{ backboneOptimized.greenrate }}"/></td>#}
{#                        </tr>#}
{#                        <tr>#}
{#                            <td>通行服务等级:</td>#}
{#                            <td><input id="backbone_service_level" type="text" placeholder="道路拥塞指数" value="{{ backbone.service_level }}"/></td>#}
{#                            <td><input id="backboneOptimized_service_level" type="text" placeholder="道路拥塞指数" value="{{ backboneOptimized.service_level }}"/></td>#}
{#                        </tr>#}
{#                    </table>#}
{#                </div>#}
                <!-- 伪元素绘制盒子下边角 -->
                <div class="panel-footer"></div>
            </div>
        </div>
    </div>
    <div class="column">
            <div class="panel" style="height:3.4rem;">
                <h2>实时仿真结果</h2>
                <!-- 图表放置盒子 -->
                <div style="margin:10px;">
                    <table id="effect_table" class="table" style="color:rgba(219,225,255,1);font-size:14px;">
                        <tr>
                            <td>路口编号:</td>
                            <td><input id="effect_id" type="text" placeholder="路口编号" value="{{ road.road_id }}"/></td>
                        </tr>
                        <tr>
                            <td>平均延误：</td>
                            <td><input id="effect_avg_delay" type="text" placeholder="平均延误"
                                       value="{{ road.avg_delay }}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>周期流量:</td>
                            <td><input id="effect_flow_volume" type="text" placeholder="周期流量"
                                       value="{{ road.flow_volume }}"/></td>
                        </tr>
                        <tr>
                            <td>平均排队长度:</td>
                            <td><input id="effect_queue_length" type="text" placeholder="平均排队长度"
                                       value="{{ road.queue_length }}"/></td>
                        </tr>
                        <tr>
                            <td>相位绿灯利用率:</td>
                            <td><input id="configuration_greenrate" type="text" placeholder="相位绿灯利用率"
                                       value="{{ configuration.greenrate }}"/></td>
                        </tr>
                        <tr>
                            <td>路口通行服务等级:</td>
                            <td><input id="effect_service_level" type="text" placeholder="路口通行服务等级"
                                       value="{{ road.service_level }}"/></td>
                        </tr>
                        <tr>
                            <td>信号合理性:</td>
                            <td><input id="effect_signal_rationality" type="text" placeholder="信号合理性"
                                       value="{{ road.signal_rationality }}"/></td>
                        </tr>
                    </table>
                </div>
                <!-- 伪元素绘制盒子下边角 -->
                <div class="panel-footer"></div>
            </div>
            <div class="panel" style="height:2.6rem;">
                <h2>路口信号灯配时方案设置</h2>
                <!-- 图表放置盒子 -->
                <div style="margin:10px;">
                    <div>
                        <h4>
                            <div class="searchBox">
                                <font style="color:rgba(219,225,255,1)">路口选择:</font>
                                <input type="text" id="search" placeholder="输入关键字选取地点" value="{{ road.road.id }}"
                                       autocomplete="on">
                            </div>
                        </h4>
                        <br/>
                    </div>
                    <br/>
                    <div>
                        <table class="table" style="color:rgba(219,225,255,1);font-size:14px;">
                            <tr>
                                <td>绿信比设置:</td>
                                <td><input id="effect_greenrate" type="text" placeholder="绿信比设置"
                                           value="{{ road.greenrate }}"/></td>
                            </tr>
                            <tr>
                                <td>周期设置:</td>
                                <td><input id="effect_flow_volume_1" type="text" placeholder="周期设置"
                                           value="{{ road.flow_volume }}"/></td>
                            </tr>
                        </table>
                    </div>
                </div>
                <!-- 伪元素绘制盒子下边角 -->
                <div class="panel-footer"></div>
            </div>
            <div class="panel bar" style="height:2.6rem;">
                <h2>相位方案设置</h2>
                <!-- 图表放置盒子 -->
                <div style="margin:10px;">
                    <div>
                        <h4><font style="color:rgba(219,225,255,1);">相位选择:</font>
                            <input id="configuration_id" type="text" placeholder="相位选择"
                                   value="{{ configuration.configuration_id }}"/></h4>
                    </div>
                    <br/>
                    <div>
                        <h4><font style="color:rgba(219,225,255,1);">通行时间设置:</font></h4>
                        <div style="margin:10px;">
                            <table class="table" style="color:rgba(219,225,255,1);font-size:14px;">
                                <tr>
                                    <td>开始时间:</td>
                                    <td><input id="configuration_green_st" type="text" placeholder="开始时间"
                                               value="{{ configuration.green_st }}"/></td>
                                </tr>
                                <tr>
                                    <td>结束时间：</td>
                                    <td><input id="configuration_green_end" type="text" placeholder="结束时间"
                                               value="{{ configuration.green_end }}"/></td>
                                </tr>
                            </table>
                        </div>

                    </div>
                </div>
                <!-- 伪元素绘制盒子下边角 -->
                <div class="panel-footer"></div>
            </div>
        </div>

</section>
<script src="{% static 'dist/js/flexible.js' %}"></script>
<script src="{% static 'dist/js/echarts.min.js' %}"></script>
<script src="{% static 'dist/js/jquery.js' %}"></script>
<!-- 引入china.js 完成地图模块 -->
<script src="{% static 'dist/js/china.js' %}"></script>
<script type="text/javascript">
    var center = ''
    var map = new AMap.Map('map', {
        width: '100%',
        height: '100%',
        center: [112.569152, 37.793622],
        zoom: 17,
        resizeEnable: true,
        rotateEnable: true,
        pitchEnable: true,
        pitch: 80,
        rotation: -15,
        // viewMode: '3D',//开启3D视图,默认为关闭
        buildingAnimation: true,//楼块出现是否带动画
        enableHighAccuracy: true,//是否使用高精度定位，默认:true
        expandZoomRange: true,
        zooms: [3, 20],
    });
    var mapInfo = {
        latitude: 0,
        longitude: 0,
        address: ''
    };

    function searchLocationId() {
        const geocoder = new AMap.Geocoder({
            radius: 1000,
            extensions: "all"
        });
        console.log([mapInfo.longitude, mapInfo.latitude]);
        geocoder.getAddress([mapInfo.longitude, mapInfo.latitude], function (status, result) {
            if (status === 'complete' && result.info === 'OK') {
                if (result && result.regeocode) {
                    // 具体地址
                    mapInfo.address = result.regeocode.formattedAddress;
                    // 省
                    mapInfo.province = result.regeocode.addressComponent.province;
                    // 市
                    mapInfo.city = result.regeocode.addressComponent.city;
                    if (mapInfo.city == '') mapInfo.city = mapInfo.province;
                    // 区
                    mapInfo.district = result.regeocode.addressComponent.district;
                    openAddress();
                }
            } else {
                alert('获取省市区失败，请重新选择地址');
            }
        });
    }

    function openAddress() {
        // cityData 你的省市区地址库为了获取省市区id
        var province = mapInfo.province;
        var city = mapInfo.city;
        var district = mapInfo.district;
        for (var i = 0; i < cityData.length; i++) {
            if (province.indexOf(cityData[i].text) >= 0 && cityData[i].children) {
                for (var j = 0; j < cityData[i].children.length; j++) {
                    if (city.indexOf(cityData[i].children[j].text) >= 0 && cityData[i].children[j].children) {
                        for (var k = 0; k < cityData[i].children[j].children.length; k++) {
                            if (cityData[i].children[j].children[k].text == district) {
                                mapInfo.provinceId = cityData[i].value;
                                mapInfo.cityId = cityData[i].children[j].value;
                                mapInfo.districtId = cityData[i].children[j].children[k].value;
                            }
                        }
                    }
                }
            }
        }
        console.log(mapInfo);
    }

    // getQueryString  获取地址栏的参数，这方法自行解决，或者留言
    // if (getQueryString('center')) {
    //     center = getQueryString('center').split(',').map(t => +t);
    // }
    //地图开始
    AMap.plugin('AMap.Geolocation', function () {
        var geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            timeout: 10000,          //超过10秒后停止定位，默认：无穷大
            convert: true,           //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
            showButton: true,        //显示定位按钮，默认：true
            showMarker: false,        //定位成功后在定位到的位置显示点标记，默认：true
            showCircle: false,        //定位成功后用圆圈表示定位精度范围，默认：true
            panToLocation: true,     //定位成功后将定位到的位置作为地图中心点，默认：true
            offset: [15, 150],//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            position: 'LB',    //定位按钮停靠位置，默认：'LB'，左下角
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition(function (status, result) {
            if (status == 'complete') {
                console.log(result);
                mapInfo.longitude = result.position.lng;
                mapInfo.latitude = result.position.lat;
                mapInfo.address = result.formattedAddress;
                // console.log(center); // center [ll9.2323,39.89797]传入回显定位
                if (center != '') {
                    map.setCenter(center)
                } else {
                    map.setCenter([result.position.lng, result.position.lat]);
                }
                $('#address').html(result.formattedAddress);
            } else {
                if (center != '') {
                    map.setCenter(center)
                }
                console.log('失败原因排查信息:' + result.message);
            }
        });
    });
    AMapUI.loadUI(['misc/PositionPicker'], function (PositionPicker) {

        var positionPicker = new PositionPicker({
            mode: 'dragMap',//dragMap：拖拽地图，dragMarker：拖拽点
            map: map
        });

        positionPicker.on('success', function (positionResult) {
            console.log(positionResult);
            mapInfo = {
                latitude: positionResult.position.lat,
                longitude: positionResult.position.lng,
                address: positionResult.regeocode.formattedAddress
            };
            document.getElementById('address').innerHTML = positionResult.address;
        });
        positionPicker.on('fail', function (positionResult) {
            document.getElementById('address').innerHTML = ' ';
        });
        positionPicker.start();
    });
    AMapUI.loadUI(['misc/PoiPicker'], function (PoiPicker) {

        const poiPicker = new PoiPicker({
            input: 'search'
        });

        //初始化poiPicker
        poiPicker.on('poiPicked', function (poiResult) {
            console.log(poiResult);
            const item = poiResult.item;
            mapInfo = {
                latitude: item.location.lat,
                longitude: item.location.lng,
                address: item.district + ' ' + item.name + ' ' + item.address
            };
            map.setCenter([item.location.lng, item.location.lat]);
            $('#search').val('');
        });
    });
</script>
<script type="text/javascript">
    $(function () {
        //页面加载完成之后自动执行
        bindBtn2Event();
    })
    {# 数据统计模块 2022.5.1 #}

    /**
     * 初始化雷达图
     * */
    function bindBtn2Event() {
        $("#btn2").click(function () {
            // 地图模块---高德地图调用
            var map = new AMap.Map('map', {
                width: '100%',
                height: '100%',
                center: [112.569152, 37.793622],
                zoom: 17,
                resizeEnable: true,
                rotateEnable: true,
                pitchEnable: true,
                pitch: 80,
                rotation: -15,
                // viewMode: '3D',//开启3D视图,默认为关闭
                buildingAnimation: true,//楼块出现是否带动画
                enableHighAccuracy: true,//是否使用高精度定位，默认:true
                expandZoomRange: true,
                zooms: [3, 20],
            });
            var mapInfo = {
                latitude: 0,
                longitude: 0,
                address: ''
            };
            var markers = [
                {   // //a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569152, 37.793622]    // 体育路与体育南路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569191, 37.830807]    // 二营盘街与体育路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.568853, 37.83881]    // 南内环街与体育路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569487, 37.817377]    // 长风街与体育路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569184, 37.807402]    // 体育路与学府街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569153, 37.796249]    // 体育路与科技街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569444, 37.815698]    // 体育路与坞城北街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569433, 37.81306]    // 体育路与八一街口交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569191, 37.830807]    // 体育路与二营盘街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.569357, 37.797413]    // 体育路与锦苑街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.564812, 37.823454]    // 体育路与亲贤街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.56171, 37.817237]    // 长风街与长治街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.552321, 37.817254]    // 长风街与平阳街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.587766, 37.817664]    // 长风街与建设南路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.583721, 37.817604]    // 长风街与坞城路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.587428, 37.817753]    // 太榆路长风街口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.575012, 37.816778]    // 军民路与长风街与交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.594142, 37.818546]    // 长风街与双塔南路口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.558659, 37.817783]    // 和平南路长风街口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584169, 37.807529]    // 坞城路学府街口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584043, 37.81228]    // 坞城东街与坞城路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584173, 37.805471]    // 坞城路与师范街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584684, 37.788468]    // 坞城路与晋阳街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584862, 37.80706]    // 坞城路省府街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584899, 37.793737]    // 坞城路与南中环街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.589281, 37.812525]    // 坞城东街与太榆路交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.58354, 37.729792]    // 坞城南路与通达街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584909, 37.751326]    // 坞城南路与电子街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584225, 37.742139]    // 坞城南路与康宁街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.583565, 37.724411]    // 坞城南路与正阳街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.577701, 37.788574]    // 坞城西路与晋阳街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.580559, 37.807414]    // 坞城中路与学府街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.585281, 37.812301]    // 坞城东街与胜负街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.58371, 37.734968]    // 坞城南路与昌盛街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584894, 37.800866]    // 坞城路许坦西街与交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.583461, 37.7182]    // 坞城南路与化章街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.585091, 37.753694]    // 坞城南路与彩虹街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.577804, 37.811656]    // 坞城西路与龙城北街街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.577706, 37.786477]    // 坞城西路与针织街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584603, 37.786777]    // 坞城南路与针织街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.58354, 37.729792]    // 坞城南路与武洛街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.572074, 37.815764]    // 坞城北街与万恒街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.585227, 37.75556]    // 坞城南路与寿康街交叉口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.572074, 37.815764]    // 坞城北街西口
                }, {
                    icon: '//webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                    position: [112.584232, 37.783728]    // 坞城南路与荣军北街交叉口
                }
                // {icon: '//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-3.png',position: []坞城南路与荣军南街交叉口},
            ];
            // 添加一些分布不均的点到地图上,地图上添加45个点标记，作为参照
            markers.forEach(function (marker) {
                new AMap.Marker({
                    map: map,
                    icon: marker.icon,
                    position: [marker.position[0], marker.position[1]],
                    offset: new AMap.Pixel(-13, -30)
                });
            });
            var center = map.getCenter();
            var setFitViewBtn = document.getElementById('setFitView');
            // 添加事件监听, 使地图自适应显示到合适的范围
            setFitViewBtn.onclick = function () {
                // 第一个参数为空，表明用图上所有覆盖物 setFitview
                // 第二个参数为false, 非立即执行
                // 第三个参数设置上左下右的空白
                map.setFitView(null, false, [150, 60, 100, 60]);
                var newCenter = map.getCenter();
                document.getElementById('centerCoord').innerHTML = '当前中心点坐标：' + newCenter.toString();
                document.getElementById('tips').innerHTML = '通过setFitView，地图自适应显示到合适的范围内,点标记已全部显示在视野中！';
            };

            // 实例化点标记
            function addMarker() {
                marker = new AMap.Marker({
                    icon: "//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png",
                    position: [112.406315, 37.908775],
                    offset: new AMap.Pixel(-13, -30)
                });
                marker.setMap(map);
            }

            function updateIcon() {
                // """更新点标记"""
                marker.setIcon('//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png')
            }

            // 矩形覆盖物
            var southWest = new AMap.LngLat(112.550688, 37.839789)
            var northEast = new AMap.LngLat(112.600263, 37.719191)
            var bounds = new AMap.Bounds(southWest, northEast)
            var rectangle = new AMap.Rectangle({
                bounds: bounds,
                strokeColor: 'red',
                strokeWeight: 6,
                strokeOpacity: 0.5,
                strokeDasharray: [30, 10],
                // strokeStyle还支持 solid
                strokeStyle: 'dashed',
                fillColor: 'blue',
                fillOpacity: 0.5,
                cursor: 'pointer',
                zIndex: 50,
            })

            function searchLocationId() {
                const geocoder = new AMap.Geocoder({
                    radius: 1000,
                    extensions: "all"
                });
                console.log([mapInfo.longitude, mapInfo.latitude]);
                geocoder.getAddress([mapInfo.longitude, mapInfo.latitude], function (status, result) {
                    if (status === 'complete' && result.info === 'OK') {
                        if (result && result.regeocode) {
                            // 具体地址
                            mapInfo.address = result.regeocode.formattedAddress;
                            // 省
                            mapInfo.province = result.regeocode.addressComponent.province;
                            // 市
                            mapInfo.city = result.regeocode.addressComponent.city;
                            if (mapInfo.city == '') mapInfo.city = mapInfo.province;
                            // 区
                            mapInfo.district = result.regeocode.addressComponent.district;
                            openAddress();
                        }
                    } else {
                        alert('获取省市区失败，请重新选择地址');
                    }
                });
            }

            function openAddress() {
                // cityData 你的省市区地址库为了获取省市区id
                var province = mapInfo.province;
                var city = mapInfo.city;
                var district = mapInfo.district;
                for (var i = 0; i < cityData.length; i++) {
                    if (province.indexOf(cityData[i].text) >= 0 && cityData[i].children) {
                        for (var j = 0; j < cityData[i].children.length; j++) {
                            if (city.indexOf(cityData[i].children[j].text) >= 0 && cityData[i].children[j].children) {
                                for (var k = 0; k < cityData[i].children[j].children.length; k++) {
                                    if (cityData[i].children[j].children[k].text == district) {
                                        mapInfo.provinceId = cityData[i].value;
                                        mapInfo.cityId = cityData[i].children[j].value;
                                        mapInfo.districtId = cityData[i].children[j].children[k].value;
                                    }
                                }
                            }
                        }
                    }
                }
                console.log(mapInfo);
            }

            AMap.plugin('AMap.Geolocation', function () {
                var geolocation = new AMap.Geolocation({
                    enableHighAccuracy: true,//是否使用高精度定位，默认:true
                    timeout: 10000,          //超过10秒后停止定位，默认：无穷大
                    convert: true,           //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
                    showButton: true,        //显示定位按钮，默认：true
                    showMarker: false,        //定位成功后在定位到的位置显示点标记，默认：true
                    showCircle: false,        //定位成功后用圆圈表示定位精度范围，默认：true
                    panToLocation: true,     //定位成功后将定位到的位置作为地图中心点，默认：true
                    offset: [15, 150],//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
                    position: 'LB',    //定位按钮停靠位置，默认：'LB'，左下角
                });
                map.addControl(geolocation);
                geolocation.getCurrentPosition(function (status, result) {
                    if (status == 'complete') {
                        console.log(result);
                        mapInfo.longitude = result.position.lng;
                        mapInfo.latitude = result.position.lat;
                        mapInfo.address = result.formattedAddress;
                        // console.log(center); // center [ll9.2323,39.89797]传入回显定位
                        if (center != '') {
                            map.setCenter(center)
                        } else {
                            map.setCenter([result.position.lng, result.position.lat]);
                        }
                        $('#address').html(result.formattedAddress);
                    } else {
                        if (center != '') {
                            map.setCenter(center)
                        }
                        console.log('失败原因排查信息:' + result.message);
                    }
                });
            });
            AMapUI.loadUI(['misc/PositionPicker'], function (PositionPicker) {
                var positionPicker = new PositionPicker({
                    mode: 'dragMap',//dragMap：拖拽地图，dragMarker：拖拽点
                    map: map
                });

                positionPicker.on('success', function (positionResult) {
                    console.log(positionResult);
                    mapInfo = {
                        latitude: positionResult.position.lat,
                        longitude: positionResult.position.lng,
                        address: positionResult.regeocode.formattedAddress
                    };
                    document.getElementById('address').innerHTML = positionResult.address;
                });
                positionPicker.on('fail', function (positionResult) {
                    document.getElementById('address').innerHTML = ' ';
                });
                positionPicker.start();
            });
            AMapUI.loadUI(['misc/PoiPicker'], function (PoiPicker) {
                const poiPicker = new PoiPicker({
                    input: 'search'
                });
                //初始化poiPicker
                poiPicker.on('poiPicked', function (poiResult) {
                    console.log(poiResult);
                    const item = poiResult.item;
                    mapInfo = {
                        latitude: item.location.lat,
                        longitude: item.location.lng,
                        address: item.district + ' ' + item.name + ' ' + item.address
                    };
                    map.setCenter([item.location.lng, item.location.lat]);
                    $('#search').val('');
                });
            });


            $.ajax({
                url: '/home/ajax/',
                type: 'post',
                data: $("#form_show").serialize(),
                success: function (res) {
                    // 将后台返回的数据更新到option中
                    if (res.status) {
                        console.log("成功！")
                        console.log(res.data.road.jingdu + ',' + res.data.road.weidu)

                        // 路口信号灯配时方案设置
                        $("#road_name").val(res.data.road.road_name)
                        $("#green_letter_ratio").val("50")
                        $("#cycle_setting").val("50")
                        $("#search").val(res.data.road.road_name)
                        // 通行时间设置
                        $("#configuration_id").val(res.data.configuration.configuration_id)
                        $("#configuration_green_st").val(res.data.configuration.green_st + 's')
                        $("#configuration_green_end").val(res.data.configuration.green_end + 's')
                        $("#configuration_greenrate").val(res.data.configuration.greenrate)
                        // 实时仿真结果
                        $("#effect_id").val(res.data.road.road_id)
                        $("#effect_avg_delay").val(res.data.road.avg_delay)
                        $("#effect_flow_volume").val(res.data.road.flow_volume)
                        $("#effect_flow_volume_1").val(res.data.road.flow_volume)
                        $("#effect_queue_length").val(res.data.road.queue_length)
                        $("#effect_greenrate").val(res.data.road.greenrate)
                        $("#effect_service_level").val(res.data.road.service_level)
                        $("#effect_signal_rationality").val(res.data.road.signal_rationality)
                        //总体效能
                        $("#summary_id").val(res.data.backbone.backbone_id)
                        $("#summary_avg_delay").val(res.data.backbone.avg_delay)
                        $("#summary_greenrate").val(res.data.backbone.greenrate)
                        $("#summary_greenrate_1").val(res.data.backbone.greenrate)
                        $("#summary_flow_volume").val(res.data.backbone.flow_volume)
                        $("#summary_queue_length").val(res.data.backbone.queue_length)
                        $("#summary_signal_rationality").val(res.data.backbone.signal_rationality)
                        $("#summary_paused_vehicle_num").val(res.data.backbone.paused_vehicle_num)
                        $("#summary_avg_passed_vehicle_num").val(res.data.backbone.avg_passed_vehicle_num)
                        $("#summary_service_level").val(res.data.backbone.service_level)
                        $("#summaryOptimized_id").val(res.data.summaryOptimized.backbone_id)
                        $("#summaryOptimized_avg_delay").val(res.data.summaryOptimized.avg_delay)
                        $("#summaryOptimized_greenrate").val(res.data.summaryOptimized.greenrate)
                        $("#summaryOptimized_greenrate_1").val(res.data.summaryOptimized.greenrate)
                        $("#summaryOptimized_flow_volume").val(res.data.summaryOptimized.flow_volume)
                        $("#summaryOptimized_queue_length").val(res.data.summaryOptimized.queue_length)
                        $("#summaryOptimized_signal_rationality").val(res.data.summaryOptimized.signal_rationality)
                        $("#summaryOptimized_paused_vehicle_num").val(res.data.summaryOptimized.paused_vehicle_num)
                        $("#summaryOptimized_avg_passed_vehicle_num").val(res.data.summaryOptimized.avg_passed_vehicle_num)
                        $("#summaryOptimized_service_level").val(res.data.summaryOptimized.service_level)
                        //多路口干线效能
                        {#$("#backbone_id").val(res.data.backbone.backbone_id)#}
                        {#$("#backbone_avg_delay").val(res.data.backbone.avg_delay)#}
                        {#$("#backbone_greenrate").val(res.data.backbone.greenrate)#}
                        {#$("#backbone_greenrate_1").val(res.data.backbone.greenrate)#}
                        {#$("#backbone_flow_volume").val(res.data.backbone.flow_volume)#}
                        {#$("#backbone_queue_length").val(res.data.backbone.queue_length)#}
                        {#$("#backbone_signal_rationality").val(res.data.backbone.signal_rationality)#}
                        {#$("#backbone_paused_vehicle_num").val(res.data.backbone.paused_vehicle_num)#}
                        {#$("#backbone_avg_passed_vehicle_num").val(res.data.backbone.avg_passed_vehicle_num)#}
                        {#$("#backbone_service_level").val(res.data.backbone.service_level)#}
                        {#$("#backboneOptimized_id").val(res.data.backboneOptimized.backbone_id)#}
                        {#$("#backboneOptimized_avg_delay").val(res.data.backboneOptimized.avg_delay)#}
                        {#$("#backboneOptimized_greenrate").val(res.data.backboneOptimized.greenrate)#}
                        {#$("#backboneOptimized_greenrate_1").val(res.data.backboneOptimized.greenrate)#}
                        {#$("#backboneOptimized_flow_volume").val(res.data.backboneOptimized.flow_volume)#}
                        {#$("#backboneOptimized_queue_length").val(res.data.backboneOptimized.queue_length)#}
                        {#$("#backboneOptimized_signal_rationality").val(res.data.backboneOptimized.signal_rationality)#}
                        {#$("#backboneOptimized_paused_vehicle_num").val(res.data.backboneOptimized.paused_vehicle_num)#}
                        {#$("#backboneOptimized_avg_passed_vehicle_num").val(res.data.backboneOptimized.avg_passed_vehicle_num)#}
                        {#$("#backboneOptimized_service_level").val(res.data.backboneOptimized.service_level)#}
                    }
                }
            })

            map.add(rectangle);
            // 缩放地图到合适的视野级别
            map.setFitView([rectangle])
            var rectangleEditor = new AMap.RectangleEditor(map, rectangle)
            rectangleEditor.on('adjust', function (event) {
                log.info('触发事件：adjust')
            })
            rectangleEditor.on('end', function (event) {
                log.info('触发事件： end')
                // event.target 即为编辑后的矩形对象
            })
        })
    }
</script>
</body>
</html>